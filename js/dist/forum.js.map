{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@nodeloc/flarum-ext-read-permission/webpack/bootstrap","webpack://@nodeloc/flarum-ext-read-permission/webpack/runtime/compat get default export","webpack://@nodeloc/flarum-ext-read-permission/webpack/runtime/define property getters","webpack://@nodeloc/flarum-ext-read-permission/webpack/runtime/hasOwnProperty shorthand","webpack://@nodeloc/flarum-ext-read-permission/webpack/runtime/make namespace object","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/app']\"","webpack://@nodeloc/flarum-ext-read-permission/./src/common/index.js","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['forum/app']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['extend']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/components/Link']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/helpers/listItems']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/helpers/highlight']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['forum/components/DiscussionListItem']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['forum/components/DiscussionPage']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['forum/components/Post']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/extend']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/components/Badge']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['forum/components/DiscussionList']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/models/Discussion']\"","webpack://@nodeloc/flarum-ext-read-permission/./src/forum/addDiscussionBadge.js","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/utils/classList']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['forum/components/DiscussionComposer']\"","webpack://@nodeloc/flarum-ext-read-permission/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@nodeloc/flarum-ext-read-permission/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/components/Button']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/components/Modal']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/components/Switch']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/utils/ItemList']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/utils/Stream']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/utils/extractText']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/components/Select']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/components/Dropdown']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/helpers/icon']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/models/Group']\"","webpack://@nodeloc/flarum-ext-read-permission/./src/forum/components/CreateReadPermissionModal.js","webpack://@nodeloc/flarum-ext-read-permission/./src/forum/addComposerItems.js","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['components/Modal']\"","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['components/Button']\"","webpack://@nodeloc/flarum-ext-read-permission/./src/forum/components/ReadFailedModal.js","webpack://@nodeloc/flarum-ext-read-permission/external root \"flarum.core.compat['common/extenders']\"","webpack://@nodeloc/flarum-ext-read-permission/./src/forum/extend.ts","webpack://@nodeloc/flarum-ext-read-permission/./src/forum/index.tsx"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/app'];","import app from 'flarum/common/app';\n\napp.initializers.add('nodeloc/flarum-ext-read-permission', () => {\n  console.log('[nodeloc/flarum-ext-read-permission] Hello, forum and admin!');\n});\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Link'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/listItems'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/highlight'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionListItem'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/Post'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Badge'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/models/Discussion'];","import app from 'flarum/forum/app';\n\nimport { extend } from 'flarum/common/extend';\nimport Badge from 'flarum/common/components/Badge';\nimport DiscussionList from 'flarum/forum/components/DiscussionList';\nimport Discussion from 'flarum/common/models/Discussion';\n\nexport default () => {\n  extend(DiscussionList.prototype, 'requestParams', (params) => {\n    params.include.push('firstPost.lottery');\n  });\n\n  extend(Discussion.prototype, 'badges', function (badges) {\n    if (this.readPermission()>0) {\n      badges.add(\n        'readPermission',\n        Badge.component({\n          type: 'readPermission',\n          label: app.translator.trans('nodeloc-read-permission.forum.tooltip.badge')+' >= '+this.readPermission(),\n          icon: 'fas fa-seedling',\n        }),\n        5\n      );\n    }\n  });\n};\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/classList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionComposer'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Modal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Switch'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/ItemList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/Stream'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/extractText'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Select'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Dropdown'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/icon'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/models/Group'];","import app from 'flarum/forum/app';\n\nimport Button from 'flarum/common/components/Button';\nimport Modal from 'flarum/common/components/Modal';\nimport Switch from 'flarum/common/components/Switch';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport Stream from 'flarum/common/utils/Stream';\nimport extractText from 'flarum/common/utils/extractText';\nimport Select from \"flarum/common/components/Select\";\nimport Dropdown from 'flarum/common/components/Dropdown';\nimport icon from 'flarum/common/helpers/icon';\nimport Group from 'flarum/common/models/Group';\n\nexport default class CreateReadPermissionModal extends Modal {\n  oninit(vnode) {\n    super.oninit(vnode);\n    if(this.attrs.selectGroup){\n      this.group = this.attrs.selectGroup;\n    }else{\n      this.group = app.store.getById('groups', Group.MEMBER_ID);\n    }\n  }\n\n  title() {\n    return app.translator.trans('nodeloc-read-permission.forum.modal.add_title');\n  }\n\n  className() {\n    return 'ReadPermissionDiscussionModal Modal--medium';\n  }\n\n  content() {\n    return [\n      <div className=\"Modal-body\">\n        <div className=\"ReadPermissionDiscussionModal-form\">{this.fields().toArray()}</div>\n      </div>,\n    ];\n  }\n\n  fields() {\n    const items = new ItemList();\n    const icons = {\n      3: 'fas fa-user',\n    };\n    items.add(\n      'readPermission',\n      <div className=\"Form-group\">\n        <label\n          className=\"label\">{app.translator.trans('nodeloc-read-permission.forum.modal.readPermission_placeholder')}</label>\n        <Dropdown label={[icon(this.group.icon() || icons[this.group.id()]), '\\t', this.group.namePlural(), ' - ', this.group.data.attributes.readPermission]} buttonClassName=\"Button Button--danger\">\n        {app.store\n          .all('groups')\n          .filter((g) => g.id() != 2)\n          .sort((a, b) => a.data.attributes.readPermission - b.data.attributes.readPermission)\n          .map((g) =>\n            Button.component(\n              {\n                active: this.group.id() === g.id(),\n                icon: g.icon() || icons[g.id()],\n                onclick: () => {\n                  this.group = g; // 更新 group 的值为当前被点击的组\n                },\n              },\n              [g.namePlural(), ' - ', g.data.attributes.readPermission] // 在组名和 read_permission 之间添加文字\n              )\n          )}\n        </Dropdown>\n      </div>,\n      100\n    );\n\n    items.add(\n      'submit',\n      <div className=\"Form-group\">\n        {Button.component(\n          {\n            type: 'submit',\n            className: 'Button Button--primary ReadPermissionModal-SubmitButton',\n            loading: this.loading,\n          },\n          app.translator.trans('nodeloc-read-permission.forum.modal.submit')\n        )}\n      </div>,\n      -10\n    );\n    return items;\n  }\n\n  onsubmit(e) {\n    e.preventDefault();\n\n    const data = this.group;\n\n    if (data === null) {\n      return;\n    }\n    const promise = this.attrs.onsubmit(data);\n\n    if (promise instanceof Promise) {\n      this.loading = true;\n\n      promise.then(this.hide.bind(this), (err) => {\n        console.error(err);\n        this.onerror(err);\n        this.loaded();\n      });\n    } else {\n      app.modal.close();\n    }\n  }\n}\n","import app from 'flarum/forum/app';\n\nimport { extend } from 'flarum/common/extend';\nimport classList from 'flarum/common/utils/classList';\nimport DiscussionComposer from 'flarum/forum/components/DiscussionComposer';\n\nimport CreateReadPermissionModal from './components/CreateReadPermissionModal';\n\nexport const addToComposer = (composer) => {\n  composer.prototype.addReadPermission = function () {\n    app.modal.show(CreateReadPermissionModal, {\n      selectGroup: this.composer.fields.selectGroup,\n      onsubmit: (selectGroup) => (this.composer.fields.selectGroup = selectGroup),\n    });\n  };\n\n  // Add button to DiscussionComposer header\n  extend(composer.prototype, 'headerItems', function (items) {\n    const discussion = this.composer.body?.attrs?.discussion;\n    items.add(\n      'readPermission',\n      <a className=\"ComposerBody-readPermission\" onclick={this.addReadPermission.bind(this)}>\n        <span className={classList('readPermissionLabel', !this.composer.fields.selectGroup && 'none')}>\n          {app.translator.trans(`nodeloc-read-permission.forum.composer_discussion.${this.composer.fields.selectGroup ? 'edit' : 'add'}_readPermission`)}\n        </span>\n      </a>,\n      4\n    );\n\n  });\n\n  extend(composer.prototype, 'data', function (data) {\n    if (this.composer.fields.selectGroup) {\n      data.readPermission = this.composer.fields.selectGroup.data.attributes.readPermission;\n    }\n  });\n};\n\nexport default () => {\n  addToComposer(DiscussionComposer);\n};\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['components/Modal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['components/Button'];","import Modal from 'flarum/components/Modal';\nimport Button from 'flarum/components/Button';\n\nexport default class ReadFailedModal extends Modal {\n  constructor(props) {\n    super(props);\n    this.readPermission = props.attrs.readPermission;\n  }\n\n  oninit(vnode) {\n    super.oninit(vnode);\n\n  }\n\n  className() {\n    return 'ReadModal Modal--small';\n  }\n\n  title() {\n    return (<div className=\"failedTitle\">{app.translator.trans('nodeloc-read-permission.forum.read-failed')}</div>);\n  }\n\n  content() {\n    return (\n      <div className=\"Modal-body\">\n        <div className=\"modalText\">{app.translator.trans('nodeloc-read-permission.forum.read-failed-detail')}{this.readPermission}</div>\n      </div>\n    );\n  }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extenders'];","import app from 'flarum/forum/app';\nimport Extend from 'flarum/common/extenders';\nimport Discussion from 'flarum/common/models/Discussion';\n\nexport default [\n\n  new Extend.Model(Discussion) //\n    .attribute<number>('readPermission'),\n  \n];\n","import app from 'flarum/forum/app';\nimport { extend, override } from 'flarum/extend';\nimport Link from 'flarum/common/components/Link';\nimport listItems from 'flarum/common/helpers/listItems';\nimport highlight from 'flarum/common/helpers/highlight';\nimport DiscussionListItem from 'flarum/forum/components/DiscussionListItem';\nimport DiscussionPage from 'flarum/forum/components/DiscussionPage';\nimport Post from 'flarum/forum/components/Post';\nimport type Mithril from 'mithril';\nimport addDiscussionBadge from './addDiscussionBadge';\n\nimport addComposerItems from './addComposerItems';\nimport ReadFailedModal from './components/ReadFailedModal';\n\nexport { default as extend } from './extend';\n\napp.initializers.add('nodeloc/flarum-ext-read-permission', () => {\n  addDiscussionBadge();\n  // console.log('[nodeloc/flarum-ext-read-permission] Hello, forum!');\n  addComposerItems();\n\n  // detect link permission\n  // index, discussion list, filter result\n  override(DiscussionListItem.prototype, 'mainView', function (): Mithril.Children {\n    const discussion = this.attrs.discussion;\n\n    //detect discussion read permission\n    let showPermissionModal = false;\n    if(discussion.attribute('readPermission') > 0 && app.session?.user) {\n      // writer or admin\n      // tips: need to give moderator high permission\n      showPermissionModal = true;\n      if (app.session?.user?.isAdmin() || app.session.user! === discussion.user()) {\n        showPermissionModal = false;\n      }\n      // check user permission\n      if(parseInt(app.session.user!.attribute('read_permission')) >= discussion.attribute('readPermission')) {\n        showPermissionModal = false;\n      }\n    }\n\n    this.permissionModal = function(e) {\n      e.preventDefault();\n      // solution1: modal box\n      app.modal.show(ReadFailedModal, { readPermission: discussion.attribute('readPermission') });\n    }\n\n    if(showPermissionModal) {\n      return (\n        <a href='javacript:void();' onclick={this.permissionModal.bind(this)} className=\"DiscussionListItem-main\">\n          <h2 className=\"DiscussionListItem-title\">{highlight(discussion.title(), this.highlightRegExp)}</h2>\n          <ul className=\"DiscussionListItem-info\">{listItems(this.infoItems().toArray())}</ul>\n        </a>\n      );\n\n    } else {\n      const jumpTo = this.getJumpTo();\n      return (\n        <Link href={app.route.discussion(discussion, jumpTo)} className=\"DiscussionListItem-main\">\n          <h2 className=\"DiscussionListItem-title\">{highlight(discussion.title(), this.highlightRegExp)}</h2>\n          <ul className=\"DiscussionListItem-info\">{listItems(this.infoItems().toArray())}</ul>\n        </Link>\n      );\n    }\n  });\n\n  //DiscussionPage\n  override(DiscussionPage.prototype, 'view', function(this: DiscussionPage, originalFunc: () => Mithril.Children): Mithril.Children {\n\n    this.detectPermission = function(): boolean{\n      const discussion = this.discussion;\n\n      if (!discussion) return;\n\n      let showPermissionModal = false;\n\n      if(discussion.attribute('readPermission') > 0) {\n        // writer or admin\n        // tips: need to give moderator high permission\n        showPermissionModal = true;\n        if (app.session?.user?.isAdmin() || app.session.user! === discussion.user()) {\n          showPermissionModal = false;\n        }\n        // check user permission\n        if(app.session && app.session.user && parseInt(app.session.user!.attribute('read_permission')) >= discussion.attribute('readPermission')) {\n          showPermissionModal = false;\n        }\n        return showPermissionModal;\n      }\n    }\n\n    if(this.detectPermission()) {\n      return (\n        <div className=\"DiscussionPage\">\n          <div className=\"DiscussionPage-discussion\">\n            <div className=\"container\">\n              <p>{app.translator.trans('nodeloc-read-permission.forum.low-permission')}</p>\n            </div>\n          </div>\n        </div>\n      );\n    } else {\n      return originalFunc();\n    }\n\n  });\n\n\n  override(Post.prototype, 'view', function(this: Post, originalFunc) {\n    // console.log(this.attrs.post);\n    if(this.attrs.post) {\n      const discussion = this.attrs.post.discussion();\n      let needPermission = false;\n      if(this.attrs.post.attribute('readPermission') > 0 && app.session?.user) {\n        // writer or admin\n        // tips: need to give moderator high permission\n        needPermission = true;\n        if (app.session?.user?.isAdmin() || app.session.user! === discussion.user()) {\n          needPermission = false;\n        }\n        // check user permission\n        if(parseInt(app.session.user!.attribute('read_permission')) >= this.attrs.post.attribute('readPermission')) {\n          needPermission = false;\n        }\n      }\n\n      if(needPermission) {\n        return app.translator.trans('nodeloc-read-permission.forum.low-permission');\n      } else {\n        return originalFunc();\n      }\n    }\n\n  });\n\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","app","add","console","log","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","_inheritsLoose","subClass","superClass","create","constructor","CreateReadPermissionModal","_Modal","apply","arguments","_proto","oninit","vnode","this","attrs","selectGroup","group","getById","Group","title","trans","className","content","m","fields","toArray","_this","items","ItemList","icons","Dropdown","label","icon","id","namePlural","data","attributes","readPermission","buttonClassName","all","filter","g","sort","b","map","Button","active","onclick","type","loading","onsubmit","e","_this2","preventDefault","promise","Promise","then","hide","err","error","onerror","loaded","close","Modal","ReadFailedModal","props","translator","Extend","Discussion","attribute","composer","extend","DiscussionList","params","include","push","badges","Badge","DiscussionComposer","addReadPermission","show","_this$composer$body","body","discussion","classList","override","DiscussionListItem","_app$session","_app$session2","showPermissionModal","user","isAdmin","parseInt","permissionModal","href","highlight","highlightRegExp","listItems","infoItems","jumpTo","getJumpTo","Link","DiscussionPage","originalFunc","detectPermission","_app$session3","Post","post","_app$session4","_app$session5","needPermission"],"sourceRoot":""}